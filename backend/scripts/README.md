# Deployment Scripts

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ production —Å–µ—Ä–≤–µ—Ä–∞.

## deploy-database.sh

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ staging –∏–ª–∏ production —Å–µ—Ä–≤–µ—Ä–µ.

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï –≤–∫–ª—é—á–µ–Ω–∞ –≤ Docker –æ–±—Ä–∞–∑—ã –∏ –¥–æ–ª–∂–Ω–∞ –¥–µ–ø–ª–æ–∏—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ!

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ staging
./scripts/deploy-database.sh staging

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ production
./scripts/deploy-database.sh production
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SCP
5. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (777 –¥–ª—è WAL mode)
6. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
7. ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è (health checks)
8. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- üöÄ –ü–µ—Ä–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ
- üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –ø–æ—Å–ª–µ –ø—Ä–æ–±–ª–µ–º
- ‚ö†Ô∏è –ü–æ—Å–ª–µ –æ—à–∏–±–∫–∏ "Database file not found" –≤ CI/CD

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- SSH –¥–æ—Å—Ç—É–ø –∫ —Ü–µ–ª–µ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- –§–∞–π–ª `database/bank_reviews.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- SSH –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è passwordless –≤—Ö–æ–¥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health check –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
curl http://89.23.99.74:8000/health/database  # staging
curl http://193.233.102.193:8000/health/database  # production
```

**–°–º. —Ç–∞–∫–∂–µ:** [docs/database-setup.md](../docs/database-setup.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

---

## diagnose-server.sh

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
ssh deploy@193.233.102.193 'bash -s' < scripts/diagnose-server.sh

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/deploy/actionable-sentiment-backend
bash scripts/diagnose-server.sh
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- ‚úÖ –í–µ—Ä—Å–∏–∏ Docker –∏ Docker Compose
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (docker-compose.yml, .env, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è GITHUB_REPOSITORY
- ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–∑–∞–ø—É—â–µ–Ω—ã/–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
- ‚úÖ –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ü–æ—Ä—Ç 8000 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–ª–∏ –Ω–µ—Ç)
- ‚úÖ Firewall —Å—Ç–∞—Ç—É—Å (UFW)
- ‚úÖ Health check –Ω–∞ localhost
- ‚úÖ Health check –Ω–∞ –≤–Ω–µ—à–Ω–µ–º IP
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (netstat)
- ‚úÖ Docker images –∏ networks

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
- –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º issue —Å –ø—Ä–æ–±–ª–µ–º–æ–π (–ø—Ä–∏–ª–æ–∂–∏—Ç–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞)

---

## fix-docker-image-path.sh

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø—É—Ç—è–º–∏ –∫ Docker –æ–±—Ä–∞–∑–∞–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
ssh deploy@193.233.102.193 'bash -s' < scripts/fix-docker-image-path.sh

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/deploy/actionable-sentiment-backend
bash scripts/fix-docker-image-path.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GITHUB_REPOSITORY` –≤ `.env` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: `sapsalevev/actionable-sentiment-backend`)
2. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±—Ä–∞–∑–∞ –≤ GitHub Container Registry (ghcr.io)
4. –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑ Dockerfile
5. –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –¥–æ—Å—Ç—É–ø–µ–Ω - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ ghcr.io
6. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
7. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health checks (localhost –∏ external IP)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É—Ç–µ–π –∫ Docker –æ–±—Ä–∞–∑–∞–º
- –ö–æ–≥–¥–∞ –æ–±—Ä–∞–∑ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ ghcr.io
- –ü—Ä–∏ –ø—É—Ç–∞–Ω–∏—Ü–µ –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –±—ç–∫–µ–Ω–¥–∞ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–æ–π –∏ –æ–±—Ä–∞–∑–æ–º –∏–∑ ghcr.io

**‚ö†Ô∏è –í–∞–∂–Ω–æ:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `sapsalevev/actionable-sentiment-backend`
- –û–±—Ä–∞–∑ –≤ ghcr.io: `ghcr.io/sapsalevev/actionable-sentiment-backend/api:latest`
- –ù–µ –ø—É—Ç–∞–π—Ç–µ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º `esapsalev/actionable-sentiment`

---

## fix-database-permissions.sh

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã SQLite WAL —Ä–µ–∂–∏–º–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
ssh deploy@193.233.102.193 'bash -s' < scripts/fix-database-permissions.sh

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/deploy/actionable-sentiment-backend
bash scripts/fix-database-permissions.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `database/` –∏ —Ñ–∞–π–ª—ã –≤–Ω—É—Ç—Ä–∏
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (`deploy:deploy`)
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞: `755` –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, `644` –¥–ª—è —Ñ–∞–π–ª–æ–≤
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
5. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health check –∏ —Å–æ–∑–¥–∞–Ω–∏–µ WAL —Ñ–∞–π–ª–æ–≤

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –û—à–∏–±–∫–∞: `attempt to write a readonly database`
- –û—à–∏–±–∫–∞: `PRAGMA journal_mode=WAL` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- –ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤

**‚ö†Ô∏è –í–∞–∂–Ω–æ:**
SQLite –≤ WAL —Ä–µ–∂–∏–º–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ `-wal` –∏ `-shm`

---

## quick-fix.sh

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å –¥–µ–ø–ª–æ–µ–º.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
ssh deploy@193.233.102.193 'bash -s' < scripts/quick-fix.sh

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /home/deploy/actionable-sentiment-backend
bash scripts/quick-fix.sh

# –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω login –≤ ghcr.io)
ssh deploy@193.233.102.193 "export GITHUB_TOKEN='ghp_xxx'; export GITHUB_USERNAME='youruser'; bash -s" < scripts/quick-fix.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. –ß–∏—Å—Ç–∏—Ç Docker (—Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã, networks)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 8000 –≤ UFW
4. –°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
5. –°–æ–∑–¥–∞–µ—Ç .env —Ñ–∞–π–ª (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
6. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç docker-compose.yml
7. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç GITHUB_REPOSITORY
8. –õ–æ–≥–∏–Ω–∏—Ç—Å—è –≤ GitHub Container Registry (–µ—Å–ª–∏ GITHUB_TOKEN –∑–∞–¥–∞–Ω)
9. –ü—É–ª–ª–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π Docker –æ–±—Ä–∞–∑
10. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
11. –ñ–¥–µ—Ç 15 —Å–µ–∫—É–Ω–¥
12. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health checks (localhost –∏ external IP)
13. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ "–Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞"
- –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –∏–∑–≤–Ω–µ

**‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- `docker-compose.yml` –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ `database/bank_reviews.db`
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) GITHUB_TOKEN –¥–ª—è login –≤ ghcr.io

---

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω, –Ω–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
# 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
ssh deploy@193.233.102.193 'bash -s' < scripts/diagnose-server.sh > diagnosis.log

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
cat diagnosis.log

# 3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—á–µ–≤–∏–¥–Ω–∞, –ø—Ä–∏–º–µ–Ω–∏—Ç—å quick-fix
ssh deploy@193.233.102.193 'bash -s' < scripts/quick-fix.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# 1. –ö–æ–ø–∏—Ä—É–µ–º docker-compose.yml
scp docker-compose.yml deploy@193.233.102.193:/home/deploy/actionable-sentiment-backend/

# 2. –ö–æ–ø–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
scp database/bank_reviews.db deploy@193.233.102.193:/home/deploy/actionable-sentiment-backend/database/

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º quick-fix
ssh deploy@193.233.102.193 "export GITHUB_TOKEN='YOUR_TOKEN'; export GITHUB_USERNAME='YOUR_USERNAME'; bash -s" < scripts/quick-fix.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞

```bash
# 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
ssh deploy@193.233.102.193 'bash -s' < scripts/diagnose-server.sh

# 2. –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –Ω–∞–ø—Ä—è–º—É—é
ssh deploy@193.233.102.193
docker-compose logs --tail=100 api

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat .env

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
ls -lh database/
sqlite3 database/bank_reviews.db "SELECT COUNT(*) FROM reviews;"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—à–∏–±–∫–∞ "readonly database"

```bash
# –ü—Ä–æ–±–ª–µ–º–∞: SQLite –Ω–µ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å WAL —Ä–µ–∂–∏–º
# –û—à–∏–±–∫–∞: attempt to write a readonly database
# –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é database/

# –†–µ—à–µ–Ω–∏–µ A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
ssh deploy@193.233.102.193 'bash -s' < scripts/fix-database-permissions.sh

# –†–µ—à–µ–Ω–∏–µ B: –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
ssh deploy@193.233.102.193
cd /home/deploy/actionable-sentiment-backend

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∞
ls -lah database/
stat database/bank_reviews.db

# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞
chown -R deploy:deploy database/ logs/
chmod -R 755 database/
chmod 644 database/*.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
docker compose down
docker compose up -d
docker compose logs -f api
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û—à–∏–±–∫–∞ "denied: denied" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—Ä–∞–∑–∞

```bash
# –ü—Ä–æ–±–ª–µ–º–∞: Image pull –∏–∑ ghcr.io –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
# –ü—Ä–∏—á–∏–Ω—ã:
# 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –æ–±—Ä–∞–∑—É (–ø—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏)
# 2. –û–±—Ä–∞–∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
# 3. –û–±—Ä–∞–∑ –µ—â–µ –Ω–µ –±—ã–ª –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω —á–µ—Ä–µ–∑ GitHub Actions

# –†–µ—à–µ–Ω–∏–µ A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fix-docker-image-path.sh (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
ssh deploy@193.233.102.193 'bash -s' < scripts/fix-docker-image-path.sh

# –†–µ—à–µ–Ω–∏–µ B: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ ghcr.io (–µ—Å–ª–∏ –æ–±—Ä–∞–∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
ssh deploy@193.233.102.193
echo YOUR_GITHUB_TOKEN | docker login ghcr.io -u YOUR_GITHUB_USERNAME --password-stdin
docker pull ghcr.io/sapsalevev/actionable-sentiment-backend/api:latest
docker-compose up -d

# –†–µ—à–µ–Ω–∏–µ C: –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ
ssh deploy@193.233.102.193
cd /home/deploy/actionable-sentiment-backend
docker-compose build
docker-compose up -d
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 6: –ü–æ—Ä—Ç 8000 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost, –Ω–æ –Ω–µ —Å–Ω–∞—Ä—É–∂–∏

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh deploy@193.233.102.193

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
sudo ufw status
sudo ufw allow 8000/tcp
sudo ufw reload

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0
docker-compose logs api | grep "Uvicorn running"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Uvicorn running on http://0.0.0.0:8000"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
sudo netstat -tulpn | grep 8000
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 0.0.0.0:8000 –∏–ª–∏ :::8000, –∞ –Ω–µ 127.0.0.1:8000
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É `deploy@193.233.102.193`
- SSH –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–∞–≤–∞ sudo –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy (–¥–ª—è UFW –∫–æ–º–∞–Ω–¥)

## Troubleshooting

### "docker-compose.yml not found"
```bash
scp docker-compose.yml deploy@193.233.102.193:/home/deploy/actionable-sentiment-backend/
```

### "Failed to pull image"
```bash
# –°–æ–∑–¥–∞–π—Ç–µ Personal Access Token –Ω–∞ GitHub
# https://github.com/settings/tokens
# Scope: read:packages

# –õ–æ–≥–∏–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh deploy@193.233.102.193
echo YOUR_TOKEN | docker login ghcr.io -u YOUR_USERNAME --password-stdin
```

### "Permission denied" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
```bash
chmod +x scripts/*.sh
```

### Scripts –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ stdin (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
ssh deploy@193.233.102.193 'bash -s' < scripts/quick-fix.sh

# –ò–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp scripts/*.sh deploy@193.233.102.193:/home/deploy/actionable-sentiment-backend/scripts/
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
